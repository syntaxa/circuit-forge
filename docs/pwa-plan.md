# План: установка и оффлайн на смартфоне (PWA)

Чтобы приложение можно было **устанавливать на смартфон и использовать оффлайн**, его нужно оформить как **PWA (Progressive Web App)**. Сейчас в проекте этого нет. Ниже — что именно нужно сделать.

---

## 1. Web App Manifest

Нужен манифест (например, `manifest.webmanifest` или `manifest.json`), чтобы браузер показывал «Установить приложение» / «Добавить на главный экран».

В манифесте должны быть:

- **name** / **short_name** — название приложения
- **start_url** — с какой страницы открывать (обычно `/` или `./`)
- **display**: `standalone` или `fullscreen` — как открывать после установки
- **icons** — иконки для установки (обязательно **192×192** и **512×512** для Android)
- **theme_color**, **background_color** — цвет полоски статуса и экрана-заставки

В `index.html` нужно добавить ссылку на манифест:

```html
<link rel="manifest" href="/manifest.webmanifest" />
```

Сейчас иконка ведёт на `https://picsum.photos/32/32` — для оффлайна и установки нужны **локальные** файлы иконок (хотя бы 192×192 и 512×512).

---

## 2. Service Worker для оффлайна

Без сервис-воркера приложение без интернета не откроется. Нужно:

- Зарегистрировать сервис-воркер (обычно в точке входа приложения, после загрузки страницы).
- В воркере кэшировать:
  - HTML (например, `index.html`),
  - JS/CSS из сборки Vite,
  - статику (иконки, шрифты и т.п.).
- Реализовать стратегию: например «сначала кэш, при отсутствии — сеть» для уже посещённых страниц.

Удобный вариант для Vite — плагин **vite-plugin-pwa**: он сам генерирует сервис-воркер и может подставить манифест. Альтернатива — свой сервис-воркер (вручную или через Workbox).

---

## 3. HTTPS

Установка и оффлайн работа PWA возможны только по **HTTPS** (или `localhost` при разработке). На смартфоне приложение должно открываться по HTTPS, иначе «Установить» не появится.

---

## 4. Зависимости из интернета (важно для оффлайна)

Сейчас в `index.html` подключено с CDN:

- **Tailwind** — `https://cdn.tailwindcss.com/...`
- **React** (importmap) — `https://aistudiocdn.com/...`
- **Иконка** — `https://picsum.photos/32/32`

При сборке Vite (`npm run build`) React подтягивается из `node_modules` и попадает в бандл, а в HTML остаётся только скрипт Tailwind с CDN. В оффлайне CDN недоступны, поэтому:

- **Tailwind** для оффлайна лучше подключить как зависимость проекта (например, PostCSS + `tailwindcss`) и собирать CSS в бандл, а не подключать `cdn.tailwindcss.com` в `index.html`.
- **Иконки** и манифест — только локальные файлы (в `public/` или в сборке).
- Importmap с `aistudiocdn.com` в прод-сборке для установки на смартфон лучше не полагаться: оставить сборку через Vite, чтобы всё было в бандле.

Итог: для стабильного оффлайна на смартфоне все критические ресурсы (HTML, JS, CSS, иконки) должны отдаваться из кэша сервис-воркера и не зависеть от CDN.

---

## 5. Иконки для установки

Нужны реальные файлы, например в `public/`:

- `icon-192.png` (192×192)
- `icon-512.png` (512×512)

И при необходимости другие размеры (72, 96, 128, 144, 152, 384), если хотите поддержку разных устройств. В манифесте указать их в `icons[]` с полями `src`, `sizes`, `type`, при желании `purpose: "any"` / `"maskable"`.

---

## 6. Регистрация сервис-воркера

После того как сервис-воркер собран (плагином или вручную), его нужно зарегистрировать в клиентском коде, например в `index.tsx` (или в корневом компоненте):

```ts
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js'); // или путь, который выдаёт vite-plugin-pwa
  });
}
```

Путь к файлу сервис-воркера должен совпадать с тем, что реально отдаётся после сборки.

---

## Краткий чек-лист

| Шаг | Действие |
|-----|----------|
| 1 | Добавить **Web App Manifest** с name, start_url, display, icons (192, 512), theme_color. |
| 2 | Подключить манифест в `index.html` через `<link rel="manifest">`. |
| 3 | Включить **Service Worker** (лучше через **vite-plugin-pwa**) и зарегистрировать его в коде. |
| 4 | Заменить CDN Tailwind на локальную сборку Tailwind, чтобы стили работали оффлайн. |
| 5 | Положить **локальные иконки** в проект и прописать их в манифесте. |
| 6 | Раздавать приложение по **HTTPS** (на смартфоне открывать по HTTPS). |

После этого пользователь на смартфоне сможет открыть сайт в браузере, нажать «Добавить на главный экран» / «Установить приложение» и использовать его оффлайн, пока нужные ресурсы закэшированы сервис-воркером.
